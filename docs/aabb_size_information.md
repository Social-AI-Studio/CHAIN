# AABB å°ºå¯¸ä¿¡æ¯æ·»åŠ 

## ğŸ¯ åŠŸèƒ½è¯´æ˜

ä¸ºäº†å¸®åŠ©Agentæ›´å¥½åœ°æ‰§è¡Œç§»åŠ¨å’Œå †å æ“ä½œï¼Œç°åœ¨ç³»ç»Ÿä¼šè‡ªåŠ¨è·å–å¹¶ä¼ é€’æ¯ä¸ªç‰©ä½“çš„**AABBï¼ˆè½´å¯¹é½åŒ…å›´ç›’ï¼‰å°ºå¯¸ä¿¡æ¯**ã€‚

## âœ… å®ç°çš„æ”¹è¿›

### 1. ç‰©ä½“å°ºå¯¸ä¿¡æ¯

**æ–‡ä»¶ï¼š** `src/phyvpuzzle/runner.py` (ç¬¬325-342è¡Œ)

#### æ·»åŠ çš„ä¿¡æ¯ï¼š

```python
# è·å–AABBï¼ˆåŒ…å›´ç›’ï¼‰å°ºå¯¸
aabb_min, aabb_max = p.getAABB(obj_id)

# è®¡ç®—å®é™…å°ºå¯¸
width = aabb_max[0] - aabb_min[0]   # xè½´æ–¹å‘ï¼ˆå®½åº¦ï¼‰
depth = aabb_max[1] - aabb_min[1]   # yè½´æ–¹å‘ï¼ˆæ·±åº¦ï¼‰
height = aabb_max[2] - aabb_min[2]  # zè½´æ–¹å‘ï¼ˆé«˜åº¦ï¼‰

# æ ¼å¼åŒ–è¾“å‡º
size_str = f"({width:.3f}, {depth:.3f}, {height:.3f})"
```

### 2. å®¹å™¨è¾¹ç•Œä¿¡æ¯

**æ–‡ä»¶ï¼š** `src/phyvpuzzle/runner.py` (ç¬¬286-300è¡Œ)

#### æ·»åŠ çš„ä¿¡æ¯ï¼š

```python
# å®¹å™¨å°ºå¯¸
- size: (width, depth, height)

# å®¹å™¨å†…éƒ¨è¾¹ç•ŒèŒƒå›´
- internal bounds: x[min, max], y[min, max], z[min, max]
```

è¿™è®©Agentèƒ½å¤Ÿï¼š
- çŸ¥é“å®¹å™¨çš„å®é™…å¤§å°
- è®¡ç®—ç‰©ä½“æ˜¯å¦èƒ½æ”¾å…¥å®¹å™¨
- ç¡®å®šåœ¨å®¹å™¨å†…çš„æœ‰æ•ˆæ”¾ç½®èŒƒå›´

## ğŸ“Š è¾“å‡ºæ ¼å¼ç¤ºä¾‹

### å®Œæ•´çš„OBJECT MAPPINGè¾“å‡ºï¼š

```
ğŸ§© OBJECT MAPPING (Complete object information - updated this step):
================================================================================
ğŸ“¦ Container:
   - object_id: 1
   - name: container
   - position: (-0.300, 0.000, 0.050)
   - size: (0.300, 0.300, 0.300)
   - internal bounds: x[-0.450, -0.150], y[-0.150, 0.150], z[0.000, 0.300]

ğŸ§© Object #1 (object_id: 2):
   - color: RGB=(255, 0, 0)
   - position: (0.150, -0.100, 0.100)
   - size: (0.080, 0.080, 0.080)

ğŸ§© Object #2 (object_id: 3):
   - color: RGB=(0, 0, 255)
   - position: (0.150, 0.100, 0.100)
   - size: (0.080, 0.080, 0.080)

================================================================================
Total movable objects: 2

ğŸ’¡ IMPORTANT:
   - Use object_id (integer) to interact with objects in tool calls
   - Position format: (x, y, z) in meters, where z is height
   - Size format: (width, depth, height) in meters - the actual dimensions of the object
   - Positions and sizes are updated after each action - always check current values!

ğŸ“ SIZE USAGE:
   - Use object size to calculate if it fits inside the container
   - Compare object size with container bounds to plan placement
   - Consider object height when stacking on top of another object
```

## ğŸ¯ Agentå¦‚ä½•ä½¿ç”¨å°ºå¯¸ä¿¡æ¯

### 1. **æ£€æŸ¥ç‰©ä½“æ˜¯å¦èƒ½æ”¾å…¥å®¹å™¨**

```python
# Agentçš„æ¨ç†è¿‡ç¨‹ï¼š
Container bounds: x[-0.450, -0.150], y[-0.150, 0.150], z[0.000, 0.300]
Container size: (0.300, 0.300, 0.300)

Object size: (0.080, 0.080, 0.080)

# æ£€æŸ¥ï¼š
- Object width (0.080) < Container width (0.300) âœ…
- Object depth (0.080) < Container depth (0.300) âœ…
- Object height (0.080) < Container height (0.300) âœ…

ç»“è®ºï¼šç‰©ä½“å¯ä»¥æ”¾å…¥å®¹å™¨
```

### 2. **è®¡ç®—æ”¾ç½®ä½ç½®**

```python
# Agentè®¡ç®—ç›®æ ‡ä½ç½®ï¼š
Container center: (-0.300, 0.000, 0.050)
Container bounds: x[-0.450, -0.150], y[-0.150, 0.150], z[0.000, 0.300]
Object size: (0.080, 0.080, 0.080)

# æ”¾åœ¨å®¹å™¨å³ä¸Šè§’ï¼š
target_x = -0.150 - 0.080/2 = -0.190  # å³è¾¹ç•Œ - åŠä¸ªç‰©ä½“å®½åº¦
target_y = 0.150 - 0.080/2 = 0.110    # ä¸Šè¾¹ç•Œ - åŠä¸ªç‰©ä½“æ·±åº¦
target_z = 0.000 + 0.080/2 = 0.040    # åº•éƒ¨ + åŠä¸ªç‰©ä½“é«˜åº¦

ç›®æ ‡ä½ç½®: (-0.190, 0.110, 0.040)
```

### 3. **è®¡ç®—å †å é«˜åº¦**

```python
# Agentè®¡ç®—å †å ï¼š
Bottom object:
- position: (x, y, z) = (-0.190, 0.110, 0.040)
- size: (0.080, 0.080, 0.080)
- top surface z = 0.040 + 0.080/2 = 0.080

Top object:
- size: (0.080, 0.080, 0.080)
- bottom should be at: 0.080
- center should be at: 0.080 + 0.080/2 = 0.120

ç›®æ ‡å †å ä½ç½®: (x, y, 0.120)
```

### 4. **éªŒè¯æ˜¯å¦åœ¨å®¹å™¨å†…**

```python
# AgentéªŒè¯å †å åçš„ç‰©ä½“æ˜¯å¦ä»åœ¨å®¹å™¨å†…ï¼š
Top object after stacking:
- position: (x, y, 0.120)
- size: (0.080, 0.080, 0.080)
- top surface: 0.120 + 0.080/2 = 0.160

Container height: 0.300
0.160 < 0.300 âœ… åœ¨å®¹å™¨å†…

ç»“è®ºï¼šå †å æˆåŠŸä¸”åœ¨å®¹å™¨å†…
```

## ğŸ“ AABBå°ºå¯¸è¯´æ˜

### ä»€ä¹ˆæ˜¯AABBï¼Ÿ

**AABB (Axis-Aligned Bounding Box)** = è½´å¯¹é½åŒ…å›´ç›’

- æ˜¯ç‰©ä½“çš„æœ€å°å¤–æ¥çŸ©å½¢æ¡†
- è¾¹ç•Œä¸åæ ‡è½´å¹³è¡Œ
- åŒ…å«ç‰©ä½“çš„æ‰€æœ‰éƒ¨åˆ†

### å°ºå¯¸è®¡ç®—æ–¹å¼ï¼š

```python
aabb_min, aabb_max = p.getAABB(object_id)

width = aabb_max[0] - aabb_min[0]   # Xè½´æ–¹å‘
depth = aabb_max[1] - aabb_min[1]   # Yè½´æ–¹å‘  
height = aabb_max[2] - aabb_min[2]  # Zè½´æ–¹å‘
```

### åæ ‡ç³»ç»Ÿï¼š

```
Y (æ·±åº¦)
â†‘
|
|___â†’ X (å®½åº¦)
/
/
Z (é«˜åº¦ï¼Œå‘ä¸‹)
```

## ğŸ”„ åŠ¨æ€æ›´æ–°

å°ºå¯¸ä¿¡æ¯ä¼šåœ¨æ¯ä¸€æ­¥æ›´æ–°ï¼š

1. **ç§»åŠ¨å‰**ï¼šæ˜¾ç¤ºå½“å‰å°ºå¯¸å’Œä½ç½®
2. **ç§»åŠ¨å**ï¼šæ˜¾ç¤ºæ–°çš„å°ºå¯¸å’Œä½ç½®
3. **æ—‹è½¬å**ï¼šAABBå¯èƒ½æ”¹å˜ï¼ˆå› ä¸ºæ˜¯è½´å¯¹é½çš„ï¼‰

### ç¤ºä¾‹ï¼š

```
Step 1 (ç§»åŠ¨å‰):
- position: (0.150, -0.100, 0.100)
- size: (0.080, 0.080, 0.080)

ç§»åŠ¨ç‰©ä½“...

Step 2 (ç§»åŠ¨å):
- position: (-0.190, 0.110, 0.040)
- size: (0.080, 0.080, 0.080)  # å°ºå¯¸ä¸å˜ï¼ˆä»…å¹³ç§»ï¼‰
```

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ”¾ç½®ç‰©ä½“åˆ°å®¹å™¨

```
1. è¯»å–å®¹å™¨è¾¹ç•Œ
2. è¯»å–ç‰©ä½“å°ºå¯¸
3. è®¡ç®—æ˜¯å¦èƒ½æ”¾å…¥
4. è®¡ç®—ç›®æ ‡ä½ç½®ï¼ˆè€ƒè™‘å°ºå¯¸ï¼‰
5. æ‰§è¡Œç§»åŠ¨
```

### åœºæ™¯2ï¼šå †å ç‰©ä½“

```
1. è¯»å–åº•éƒ¨ç‰©ä½“ä½ç½®å’Œå°ºå¯¸
2. è®¡ç®—é¡¶éƒ¨è¡¨é¢é«˜åº¦
3. è¯»å–é¡¶éƒ¨ç‰©ä½“å°ºå¯¸
4. è®¡ç®—é¡¶éƒ¨ç‰©ä½“çš„ç›®æ ‡ä½ç½®
5. éªŒè¯æ˜¯å¦åœ¨å®¹å™¨å†…
6. æ‰§è¡Œç§»åŠ¨
```

### åœºæ™¯3ï¼šå¯¹é½ç‰©ä½“

```
1. è¯»å–ä¸¤ä¸ªç‰©ä½“çš„å°ºå¯¸
2. å¦‚æœå°ºå¯¸ç›¸åŒï¼šç›´æ¥å¯¹é½ä¸­å¿ƒç‚¹
3. å¦‚æœå°ºå¯¸ä¸åŒï¼šæ ¹æ®éœ€æ±‚å¯¹é½è¾¹ç¼˜æˆ–ä¸­å¿ƒ
4. æ‰§è¡Œç§»åŠ¨
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### å®¹å™¨ä¿¡æ¯æ ¼å¼ï¼š

```
ğŸ“¦ Container:
   - object_id: {int}                    # ç‰©ä½“ID
   - name: {string}                      # åç§°
   - position: (x, y, z)                 # ä¸­å¿ƒä½ç½®ï¼ˆç±³ï¼‰
   - size: (width, depth, height)        # å°ºå¯¸ï¼ˆç±³ï¼‰
   - internal bounds: x[min, max], ...   # å†…éƒ¨è¾¹ç•ŒèŒƒå›´ï¼ˆç±³ï¼‰
```

### ç‰©ä½“ä¿¡æ¯æ ¼å¼ï¼š

```
ğŸ§© Object #{number} (object_id: {int}):
   - color: RGB=(r, g, b)                # é¢œè‰²ï¼ˆ0-255ï¼‰
   - position: (x, y, z)                 # ä¸­å¿ƒä½ç½®ï¼ˆç±³ï¼‰
   - size: (width, depth, height)        # å°ºå¯¸ï¼ˆç±³ï¼‰
```

## âœ¨ ä¼˜åŠ¿æ€»ç»“

### å¯¹Agentçš„å¸®åŠ©ï¼š

âœ… **ç²¾ç¡®è®¡ç®—** - çŸ¥é“ç‰©ä½“å®é™…å°ºå¯¸ï¼Œè®¡ç®—æ›´å‡†ç¡®  
âœ… **ç©ºé—´è§„åˆ’** - åˆ¤æ–­ç‰©ä½“æ˜¯å¦èƒ½æ”¾å…¥å®¹å™¨  
âœ… **å †å å¯¹é½** - è®¡ç®—å‡†ç¡®çš„å †å ä½ç½®  
âœ… **ç¢°æ’é¿å…** - é¢„æµ‹ç‰©ä½“æ˜¯å¦ä¼šç¢°æ’  
âœ… **è¾¹ç•Œæ£€æŸ¥** - ç¡®ä¿æ“ä½œåœ¨æœ‰æ•ˆèŒƒå›´å†…  

### å®é™…æ•ˆæœï¼š

- ğŸ¯ å‡å°‘è¯•é”™æ¬¡æ•°
- ğŸ“ æé«˜æ”¾ç½®ç²¾åº¦
- ğŸ—ï¸ æ”¹å–„å †å ç¨³å®šæ€§
- âš¡ åŠ å¿«ä»»åŠ¡å®Œæˆé€Ÿåº¦
- ğŸ“ æå‡æ¨ç†è´¨é‡

## ğŸ“ æ€»ç»“

é€šè¿‡æ·»åŠ AABBå°ºå¯¸ä¿¡æ¯ï¼ŒAgentç°åœ¨å¯ä»¥ï¼š

1. **çŸ¥é“ç‰©ä½“å¤§å°** - æ¯ä¸ªç‰©ä½“çš„å®é™…å°ºå¯¸
2. **è®¡ç®—ç©ºé—´å…³ç³»** - ç‰©ä½“ä¸å®¹å™¨çš„ç›¸å¯¹å¤§å°
3. **è§„åˆ’ç²¾ç¡®ä½ç½®** - åŸºäºå°ºå¯¸è®¡ç®—ç›®æ ‡åæ ‡
4. **éªŒè¯æ“ä½œå¯è¡Œæ€§** - æ£€æŸ¥æ˜¯å¦æ»¡è¶³ç©ºé—´çº¦æŸ
5. **å®ç°ç²¾ç¡®å †å ** - è®¡ç®—å‡†ç¡®çš„å †å é«˜åº¦

è¿™å¤§å¤§æå‡äº†Agentæ‰§è¡Œç‰©ç†æ“ä½œä»»åŠ¡çš„èƒ½åŠ›ï¼ğŸ‰

