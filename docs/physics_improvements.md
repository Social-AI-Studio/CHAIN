# 物理参数优化 - 重物体与柔和碰撞

## 🎯 优化目标

1. **物体更重** - 增加质量，提高稳定性
2. **碰撞柔和** - 减少反弹和晃动，快速稳定

## ✅ 实施的改进

### 1. 增加拼图块质量

**文件：** `src/phyvpuzzle/tasks/simple_stacking.py` (第165-183行)

#### 变化：

**之前：**
```python
mass=0.05  # 很轻，容易被推动
```

**现在：**
```python
mass=0.5  # 增加10倍质量，物体更重更稳定
```

#### 效果：
- ✅ 拼图块质量从 **0.05kg** 增加到 **0.5kg**（10倍）
- ✅ 物体更难被推动
- ✅ 堆叠更稳定
- ✅ 降低意外滑动的风险

### 2. 增加阻尼参数（柔和碰撞）

**文件：** `src/phyvpuzzle/environment/base_env.py`

#### 线性和角度阻尼：

**之前：**
```python
linearDamping=0.04   # 低阻尼，碰撞后会有明显反弹
angularDamping=0.04  # 低阻尼，碰撞后会旋转晃动
```

**现在：**
```python
linearDamping=0.5    # 高阻尼（增加12.5倍），碰撞后快速稳定
angularDamping=0.5   # 高阻尼（增加12.5倍），碰撞后快速停止旋转
```

#### 效果：
- ✅ 碰撞后的反弹大幅减少
- ✅ 物体快速停止运动（1-2秒内稳定）
- ✅ 旋转和晃动迅速衰减
- ✅ 堆叠后更快达到稳定状态

### 3. 增加摩擦力

**文件：** `src/phyvpuzzle/environment/base_env.py`

#### 各种摩擦参数：

**之前：**
```python
lateralFriction=1.0      # 标准摩擦
spinningFriction=0.002   # 很低的旋转摩擦
rollingFriction=0.002    # 很低的滚动摩擦
```

**现在：**
```python
lateralFriction=1.5      # 增加50%，减少滑动
spinningFriction=0.005   # 增加2.5倍，减少旋转
rollingFriction=0.005    # 增加2.5倍，减少滚动
```

#### 效果：
- ✅ 物体放置后不易滑动
- ✅ 减少旋转运动
- ✅ 物体更容易保持在原位
- ✅ 堆叠对齐更容易维持

### 4. 保持零弹性

**参数：**
```python
restitution=0.0  # 无弹性，碰撞后不反弹
```

#### 效果：
- ✅ 碰撞后没有弹跳
- ✅ 能量完全吸收
- ✅ 物体相互接触后立即停止

## 📊 物理参数对比表

| 参数 | 之前 | 现在 | 变化 | 效果 |
|------|------|------|------|------|
| **质量 (mass)** | 0.05kg | 0.5kg | **↑ 10倍** | 物体更重更稳定 |
| **线性阻尼 (linearDamping)** | 0.04 | 0.5 | **↑ 12.5倍** | 减少平移运动 |
| **角度阻尼 (angularDamping)** | 0.04 | 0.5 | **↑ 12.5倍** | 减少旋转晃动 |
| **侧向摩擦 (lateralFriction)** | 1.0 | 1.5 | **↑ 50%** | 减少滑动 |
| **旋转摩擦 (spinningFriction)** | 0.002 | 0.005 | **↑ 2.5倍** | 减少旋转 |
| **滚动摩擦 (rollingFriction)** | 0.002 | 0.005 | **↑ 2.5倍** | 减少滚动 |
| **弹性系数 (restitution)** | 0.0 | 0.0 | 不变 | 无反弹 |

## 🎬 实际效果

### 碰撞行为变化

#### 之前（低质量 + 低阻尼）：
```
1. 拼图块A快速移动并撞击拼图块B
2. 碰撞后：
   - 两个块都反弹 ❌
   - 发生滑动和旋转 ❌
   - 需要5-10秒才稳定 ❌
   - 可能从容器中弹出 ❌
```

#### 现在（重质量 + 高阻尼）：
```
1. 拼图块A移动并接触拼图块B
2. 碰撞后：
   - 无反弹，能量被吸收 ✅
   - 轻微位移后立即停止 ✅
   - 1-2秒内完全稳定 ✅
   - 保持在容器内 ✅
```

### 堆叠稳定性

#### 之前：
- ❌ 上层块容易滑落
- ❌ 堆叠后晃动明显
- ❌ 对齐困难

#### 现在：
- ✅ 上层块牢固放置
- ✅ 堆叠快速稳定
- ✅ 对齐容易保持

## 🔧 适用范围

这些改进会影响：

1. **simple_stacking 任务** ✅
   - piece_2 和 piece_3 的质量增加到 0.5kg
   - 使用优化的阻尼和摩擦参数

2. **three_by_three_stacking 任务** ✅
   - 从URDF加载的拼图块自动使用新参数
   - 碰撞更柔和，堆叠更稳定

3. **所有使用 add_object() 的任务** ✅
   - 非容器物体自动使用新的物理参数

4. **所有使用 create_primitive_object() 的任务** ✅
   - mass > 0 的物体自动使用新参数

## ⚙️ 容器特殊处理

容器保持完全固定（不受影响）：

```python
# 容器参数（保持不变）
if is_container:
    mass=0.0                # 质量为0（固定）
    linearDamping=0.0       # 无阻尼
    angularDamping=0.0      # 无阻尼
    useFixedBase=True       # 固定基座
```

## 📝 配置灵活性

如果需要调整柔和程度，可以修改配置文件：

```yaml
environment:
  enable_soft_collision: true
  soft_collision_damping: 0.8  # 范围：0.1-1.0，值越大越柔和
```

或者直接修改代码中的默认值：
```python
lin_damp = 0.5  # 调整这个值：0.1-1.0
ang_damp = 0.5  # 调整这个值：0.1-1.0
```

## 🎯 推荐设置

根据任务需求选择：

### 精确堆叠任务（当前设置）：
```python
mass = 0.5
linearDamping = 0.5
angularDamping = 0.5
lateralFriction = 1.5
```
**效果：** 重物体 + 高阻尼 = 快速稳定，适合精确操作

### 需要更快稳定：
```python
mass = 0.5
linearDamping = 0.8
angularDamping = 0.8
lateralFriction = 2.0
```
**效果：** 几乎无反弹，立即稳定

### 需要轻微运动：
```python
mass = 0.3
linearDamping = 0.3
angularDamping = 0.3
lateralFriction = 1.2
```
**效果：** 中等质量和阻尼，有一定动态感

## ✨ 总结

### 已实现的优化

✅ **物体质量增加** - 从 0.05kg → 0.5kg (10倍)  
✅ **阻尼大幅提升** - 从 0.04 → 0.5 (12.5倍)  
✅ **摩擦力增强** - 侧向摩擦增加50%  
✅ **碰撞柔和** - 无反弹，快速稳定  
✅ **容器固定** - 保持完全静止  

### 实际效果

- 🎯 拼图块更重，不易被意外推动
- 🛡️ 碰撞后能量快速吸收，无反弹
- ⚡ 1-2秒内达到稳定状态
- 📍 对齐位置容易保持
- 🏗️ 堆叠更加可靠和稳定

现在的物理环境更适合精确的操作和稳定的堆叠任务！🎉

